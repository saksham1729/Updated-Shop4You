<!doctype html>
{% load static %}


<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <!--Owl Carousel CSS-->
    <link rel="stylesheet" href="{% static 'app/css/owl.carousel.min.css' %}">

    <!--FontAwesome CSS-->
    <link rel="stylesheet" href="{% static 'app/css/all.min.css' %}">

    <!--Custom CSS-->
    <link rel="stylesheet" href="{% static 'app/css/style.css' %}">

    <!-- BotUI CSS (you keep this!) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui.min.css">

<!-- ‚úÖ Use Vue 2.6 (compatible with BotUI) -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>

<!-- BotUI JS -->
<script src="https://cdn.jsdelivr.net/npm/botui/build/botui.min.js"></script>


    <title>Shop4You | {% block title %} {% endblock title %} </title>

    
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
     <div class="container">
       <a class="navbar-brand" href="/">Shop4You</a>
       <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <div class="collapse navbar-collapse" id="navbarSupportedContent">
         <ul class="navbar-nav me-auto mb-2 mb-lg-0">
           <li class="nav-item">
             <a class="nav-link active" aria-current="page" href="/">Home</a>
           </li>
           <li class="nav-item dropdown">
             <a class="nav-link dropdown-toggle text-white" href="#" id="electronicsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
               Electronics
             </a>
             <ul class="dropdown-menu" aria-labelledby="electronicsDropdown">
               <li><a class="dropdown-item" href="{% url 'mobile' %}">Mobile</a></li>
               <li><a class="dropdown-item" href="{% url 'laptop' %}">Laptop</a></li>
             </ul>
           </li>
           <li class="nav-item dropdown">
             <a class="nav-link dropdown-toggle text-white" href="#" id="fashionDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
               Fashion
             </a>
             <ul class="dropdown-menu" aria-labelledby="fashionDropdown">
               <li><a class="dropdown-item" href="{% url 'topwear' %}">Top Wear</a></li>
               <li><a class="dropdown-item" href="{% url 'bottomwear' %}">Bottom Wear</a></li>
             </ul>
           </li>
         </ul>
         
        <div class="position-relative" style="width: 300px;">
  <input class="form-control me-2" type="search" id="search-input" placeholder="Search for products...">
  <div id="search-results" class="bg-white shadow rounded p-2" style="position: absolute; top: 100%; left: 0; right: 0; display: none; z-index: 1000;"></div>
</div>


         <div>
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          {% if request.user.is_authenticated %}
           <li class="nav-item dropdown mx-2">
              <a class="nav-link dropdown-toggle d-flex align-items-center text-white" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {% if request.user.is_authenticated and request.user.profile.image %}
                  <img src="{{ request.user.profile.image.url }}" class="rounded-circle me-2" width="30" height="30" alt="Profile Pic">
                {% endif %}

                
                <h6>Hello,
                {{ request.user.username|capfirst }} !</h6>
              </a>

              <ul class="dropdown-menu" aria-labelledby="profileDropdown">
                <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
                <li><a class="dropdown-item" href="{% url 'orders' %}">Orders</a></li>
                <li><a class="dropdown-item" href="{% url 'passwordchange' %}">Change Password</a></li>
                <li>
                    <form method="post" action="{% url 'logout' %}">
                      {% csrf_token %}
                      <button type="submit" class="dropdown-item logout-btn"> Logout</button>
                    </form>
                </li>
              </ul>
            </li>
            <li class="nav-item mx-2">
              <a href="{% url 'showcart' %}" class="nav-link text-white"><span class="badge bg-danger" id="cart-item-count">{{ totalitem }}</span> Cart </a>
            </li>
            <!--Dark Mode-->
            <li class="nav-item mx-2">
                <button id="darkModeToggle" class="btn btn-outline-light btn-sm">
                  üåô Dark Mode
                </button>
            </li>

            {% else %}
            <li class="nav-item mx-2">
             <a href="{% url 'login' %}" class="nav-link text-white">Login</a>
            </li>
            <li class="nav-item mx-2">
             <a href="{% url 'customerregistration' %}" class="nav-link text-white">Registration</a>
            </li>
            {% endif %}
          </ul>
         </div>
       </div>
     </div>
    </nav>
    {% block banner_slider %} {% endblock banner_slider %}
    {% block livesale %} {% endblock livesale %}
    {% block main-content %}  {% endblock main-content %}

   

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>


<script>
  $(document).ready(function () {
    $('#search-input').on('keyup', function () {
      var query = $(this).val();
      if (query.length > 0) {
        $.ajax({
          url: '/search/',
          data: { 'term': query },
          dataType: 'json',
          success: function (data) {
            let output = '';
            if (data.results.length > 0) {
              data.results.forEach(item => {
                output += `
                  <div class="search-item p-2 border-bottom">
                    <a href="/product-detail/${item.id}" class="text-decoration-none text-dark d-flex align-items-center">
                      <img src="${item.image}" width="40" height="40" class="me-2" />
                      <div>
                        <strong>${item.title}</strong><br>
                        <small>Rs. ${item.price}</small>
                      </div>
                    </a>
                  </div>
                `;
              });
            } else {
              output = '<p class="p-2">No products found</p>';
            }
            $('#search-results').html(output).show();
          }
        });
      } else {
        $('#search-results').hide();
      }
    });

    // Hide on click outside
    $(document).click(function (e) {
      if (!$(e.target).closest('#search-form').length) {
        $('#search-results').hide();
      }
    });
  });
</script>

    
    <script src="{% static 'app/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'app/js/all.min.js' %}"></script>
    <script src="{% static 'app/js/myscript.js' %}"></script>

      
      <!--DarkMode-->
      <script>
      document.addEventListener('DOMContentLoaded', function () {
        const toggleBtn = document.getElementById('darkModeToggle');
        const body = document.body;

        // Load saved preference from localStorage
        if (localStorage.getItem('darkMode') === 'enabled') {
          body.classList.add('dark-mode');
          toggleBtn.textContent = '‚òÄÔ∏è Light Mode';
        }

        toggleBtn.addEventListener('click', () => {
          body.classList.toggle('dark-mode');

          if (body.classList.contains('dark-mode')) {
            localStorage.setItem('darkMode', 'enabled');
            toggleBtn.textContent = '‚òÄÔ∏è Light Mode';
          } else {
            localStorage.setItem('darkMode', 'disabled');
            toggleBtn.textContent = 'üåô Dark Mode';
          }
        });
      });
    </script>
<!--
    <script src="https://cdn.botpress.cloud/webchat/v3.0/inject.js"></script>
    <script src="https://files.bpcontent.cloud/2025/07/14/07/20250714073308-ZP8OIVXO.js"></script>
-->

<!-- Chat Toggle Icon -->
<div id="chat-toggle" class="bg-primary text-white rounded-circle shadow d-flex align-items-center justify-content-center"
     style="width:50px; height:50px; position:fixed; bottom:25px; right:25px; z-index:10000; cursor:pointer;"
     title="Chat with us">
  üí¨
</div>
<!-- Chat Window -->
<div id="botui-wrapper" class="fade collapse position-fixed border shadow">
  <div class="botui-header">
    <span>Chat Assistant</span>
    <span id="chat-close">&times;</span>
  </div>
  <div id="botui-app"><bot-ui></bot-ui></div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
  const toggle = document.getElementById('chat-toggle');
  const wrapper = document.getElementById('botui-wrapper');
  const closeBtn = document.getElementById('chat-close');
  const botui = new BotUI('botui-app');
  let chatStarted = false;

  // üö™ Open chat window
  toggle.addEventListener('click', () => {
    toggle.classList.add('rotate');
    setTimeout(() => toggle.classList.remove('rotate'), 600);
    wrapper.style.display = 'block';
    wrapper.classList.add('show');

    if (!chatStarted) {
      startChat();
      chatStarted = true;
    }
  });

  // ‚ùå Close chat via "X"
  closeBtn.addEventListener('click', () => {
    wrapper.classList.remove('show');
    setTimeout(() => wrapper.style.display = 'none', 300);
  });

  // üßº Close chat by clicking outside
  document.addEventListener('click', (e) => {
    const clickedInside = wrapper.contains(e.target) || toggle.contains(e.target);
    if (!clickedInside && wrapper.style.display === 'block') {
      wrapper.classList.remove('show');
      setTimeout(() => wrapper.style.display = 'none', 300);
    }
  });

  // üó£Ô∏è Welcome only once
  function startChat() {
    botui.message.add({ content: 'üëã Hello! Ask me about any product, your cart or your orders.' }).then(() => {
      promptUser();
    });
  }

  // üîÑ Repeating chat loop
  function promptUser() {
    botui.action.text({ action: { placeholder: 'Type your query...' } })
      .then((res) => {
        fetch(`/api/chatbot?q=${encodeURIComponent(res.value)}`)
          .then(response => response.json())
          .then(data => {
            botui.message.add({ content: data.response });
            setTimeout(promptUser, 800);
          }).catch(() => {
            botui.message.add({ content: '‚ö†Ô∏è Something went wrong. Try again!' });
            setTimeout(promptUser, 800);
          });
      });
  }
});
</script>


 <!-- Start Footer -->
    <footer class="container-fluid bg-dark text-center p-2 mt-5">
        <small class="text-white">Copyright &copy; 2021 || Designed By @ || </small>
        <img src="{% static 'app/images/payment.png' %}" alt="" srcset="" class="img-fluid" height="2px">

      
        
    </footer> <!-- End Footer -->



  </body>
</html>